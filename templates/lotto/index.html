{% extends 'base.html' %}

{% block title %}로또 번호 추첨기{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <!-- 번호 추첨 카드 -->
        <div class="card">
            <div class="card-header">
                <i class="fas fa-random"></i> 로또 번호 추첨
            </div>
            <div class="card-body">
                <p class="card-text">버튼을 클릭하면 1부터 45까지의 숫자 중 무작위로 6개의 번호가 선택됩니다.</p>
                <div class="mb-3">
                    <label for="excludeNumbers" class="form-label">제외할 번호 (쉼표로 구분)</label>
                    <input type="text" class="form-control" id="excludeNumbers" placeholder="예: 1, 2, 3">
                    <div class="form-text">제외하고 싶은 번호를 쉼표로 구분하여 입력하세요 (1-45 사이의 숫자)</div>
                </div>
                <button id="generateBtn" class="btn btn-primary btn-lg w-100">
                    <i class="fas fa-sync-alt"></i> 번호 추첨하기
                </button>
                
                <div class="loading">
                    <div class="spin"><i class="fas fa-spinner fa-2x"></i></div>
                    <p>추첨 중...</p>
                </div>
                
                <div id="lottoResult" class="text-center mt-4" style="min-height: 80px;">
                    <!-- 추첨된 번호가 여기에 표시됩니다 -->
                </div>
            </div>
        </div>
        
        <!-- 최근 당첨 번호 -->
        <div class="card">
            <div class="card-header">
                <i class="fas fa-history"></i> 최근 당첨 번호
            </div>
            <div class="card-body">
                <div id="recentDraws">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>회차</th>
                                    <th>당첨일</th>
                                    <th>당첨번호</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- 최근 5회차 당첨번호 하드코딩 -->
                                <tr>
                                    <td>1169회</td>
                                    <td>2024-04-26</td>
                                    <td>
                                        <div class="d-flex flex-wrap justify-content-center">
                                            <div class="lotto-ball history-ball ball-1-10">5</div>
                                            <div class="lotto-ball history-ball ball-11-20">12</div>
                                            <div class="lotto-ball history-ball ball-21-30">24</div>
                                            <div class="lotto-ball history-ball ball-21-30">26</div>
                                            <div class="lotto-ball history-ball ball-31-40">39</div>
                                            <div class="lotto-ball history-ball ball-41-45">42</div>
                                            <span class="mx-2">+</span>
                                            <div class="lotto-ball history-ball ball-11-20">20</div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>1168회</td>
                                    <td>2024-04-19</td>
                                    <td>
                                        <div class="d-flex flex-wrap justify-content-center">
                                            <div class="lotto-ball history-ball ball-1-10">9</div>
                                            <div class="lotto-ball history-ball ball-21-30">21</div>
                                            <div class="lotto-ball history-ball ball-21-30">24</div>
                                            <div class="lotto-ball history-ball ball-31-40">30</div>
                                            <div class="lotto-ball history-ball ball-31-40">33</div>
                                            <div class="lotto-ball history-ball ball-31-40">37</div>
                                            <span class="mx-2">+</span>
                                            <div class="lotto-ball history-ball ball-11-20">29</div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>1167회</td>
                                    <td>2024-04-12</td>
                                    <td>
                                        <div class="d-flex flex-wrap justify-content-center">
                                            <div class="lotto-ball history-ball ball-1-10">8</div>
                                            <div class="lotto-ball history-ball ball-21-30">23</div>
                                            <div class="lotto-ball history-ball ball-31-40">31</div>
                                            <div class="lotto-ball history-ball ball-31-40">35</div>
                                            <div class="lotto-ball history-ball ball-31-40">39</div>
                                            <div class="lotto-ball history-ball ball-31-40">40</div>
                                            <span class="mx-2">+</span>
                                            <div class="lotto-ball history-ball ball-21-30">24</div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>1166회</td>
                                    <td>2024-04-05</td>
                                    <td>
                                        <div class="d-flex flex-wrap justify-content-center">
                                            <div class="lotto-ball history-ball ball-11-20">14</div>
                                            <div class="lotto-ball history-ball ball-21-30">23</div>
                                            <div class="lotto-ball history-ball ball-21-30">25</div>
                                            <div class="lotto-ball history-ball ball-21-30">27</div>
                                            <div class="lotto-ball history-ball ball-21-30">29</div>
                                            <div class="lotto-ball history-ball ball-41-45">42</div>
                                            <span class="mx-2">+</span>
                                            <div class="lotto-ball history-ball ball-11-20">16</div>
                                        </div>
                                    </td>
                                </tr>
                                <!-- 여기에 더 많은 회차를 추가할 수 있습니다 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    $(document).ready(function() {
        // 번호 생성 버튼 클릭 이벤트
        $("#generateBtn").click(function() {
            generateLottoNumbers();
        });
        
        // 로또 번호 생성 함수
        function generateLottoNumbers() {
            $("#lottoResult").empty();
            $(".loading").show();
            
            // 사용자가 입력한 제외할 번호 처리
            const excludeNumbersInput = $("#excludeNumbers").val().trim();
            let excludeNumbers = [];
            if (excludeNumbersInput) {
                excludeNumbers = excludeNumbersInput.split(',').map(num => parseInt(num.trim())).filter(num => !isNaN(num) && num >= 1 && num <= 45);
            }
            
            // 서버 API 호출
            fetch(`/lottery/numbers?exclude_numbers=${excludeNumbers.join(',')}`)
                .then(response => response.json())
                .then(numbers => {
                    // 결과 표시
                    numbers.forEach((number, index) => {
                        // 번호 등장에 약간의 애니메이션 효과를 주기 위한 지연
                        setTimeout(() => {
                            $("#lottoResult").append(getBallHTML(number));
                        }, index * 300);
                    });
                    
                    $(".loading").hide();
                })
                .catch(error => {
                    $("#lottoResult").html('<div class="alert alert-danger">번호 생성 중 오류가 발생했습니다.</div>');
                    $(".loading").hide();
                    console.error("API 호출 오류:", error);
                });
        }
        
        // 로또 볼 HTML 생성 함수
        function getBallHTML(number, extraClass = '') {
            let ballClass = 'lotto-ball ';
            
            // 번호 범위에 따른 색상 클래스 추가
            if (number >= 1 && number <= 10) {
                ballClass += 'ball-1-10';
            } else if (number >= 11 && number <= 20) {
                ballClass += 'ball-11-20';
            } else if (number >= 21 && number <= 30) {
                ballClass += 'ball-21-30';
            } else if (number >= 31 && number <= 40) {
                ballClass += 'ball-31-40';
            } else {
                ballClass += 'ball-41-45';
            }
            
            // 추가 클래스가 있으면 추가
            if (extraClass) {
                ballClass += ' ' + extraClass;
            }
            
            return `<div class="${ballClass}">${number}</div>`;
        }
    });
</script>
{% endblock %} 